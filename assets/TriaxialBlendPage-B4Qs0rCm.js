import{r as n,j as e}from"./vendor-react-D0vdeqNS.js";import{R as E}from"./index-B8AH_Q18.js";import{s as A,a as f}from"./simplex-BLCvhNW8.js";import{r as T}from"./umf-DcIxpM70.js";import{u as k,m as $}from"./index-Cx-RWLMS.js";import{a as p,f as t,b as D}from"./blend-xGiHwjeo.js";import{exportBlendCSV as L,printLabels as w}from"./export-UL09t0Ez.js";import{u as P}from"./usePageTitle-Dfez-EUD.js";import{c as K}from"./calc-styles-u5C4IXOP.js";import{u as U}from"./vendor-router-DjLFn5nj.js";import"./vendor-state-DTYbmM1J.js";const m=["#e74c3c","#2ecc71","#3498db"],V=["A","B","C"];function Y(){P("Triaxial Blend");const[c,v]=n.useState([null,null,null]),[o,g]=n.useState(5),[a,x]=n.useState(null),[C,h]=n.useState([]),{setBlendResults:y,blendRecipes:b,clearBlendRecipes:M}=k(),O=U(),R=f(3,o);n.useEffect(()=>{b.length>=3&&(v(b.slice(0,3)),M())},[]);const S=n.useCallback((s,l)=>{v(i=>{const d=[...i];return d[s]=l,d}),x(null)},[]),j=n.useMemo(()=>c.every(s=>s&&s.ingredients.some(l=>l.material.trim()&&l.amount>0)),[c]),N=n.useCallback(()=>{if(!j)return;h([]);const s=c,l=s.map(r=>T(r,$)),i=l.flatMap(r=>r.errors),d=l.map(r=>r.value);if(d.some(r=>!r)){h(i.length>0?i:["Could not calculate UMF for one or more recipes"]);return}const B=d.filter(r=>r!==null),u=A({recipes:s,divisions:o},B);u.value?(x(u.value),h([...u.warnings])):h([...u.errors])},[c,o,j]);return e.jsxs("div",{className:"calc-page",children:[e.jsxs("div",{className:"calc-sidebar",onKeyDown:s=>{s.key==="Enter"&&!(s.target instanceof HTMLTextAreaElement)&&N()},children:[e.jsxs("div",{className:"calc-section",children:[e.jsx("h2",{children:"Triaxial Blend"}),e.jsx("p",{className:"subtitle",children:"Three corners on a simplex triangle — every combination that sums to 100%"})]}),e.jsxs("div",{className:"calc-section",children:[e.jsx("h3",{children:"Corner Recipes"}),V.map((s,l)=>e.jsx(E,{label:`Corner ${s}`,color:m[l],recipe:c[l],onChange:i=>S(l,i),compact:!0},s))]}),e.jsxs("div",{className:"calc-section",children:[e.jsx("h3",{children:"Divisions"}),e.jsx("div",{className:"calc-controls",children:e.jsxs("div",{className:"control-row",children:[e.jsx("input",{type:"range",min:"2",max:"15",value:o,onChange:s=>{g(Number(s.target.value)),x(null)}}),e.jsx("span",{className:"range-value",children:o})]})}),e.jsxs("div",{className:"point-count",children:[e.jsx("strong",{children:R})," blend points"]})]}),C.length>0&&e.jsx("div",{className:"calc-section",children:C.map((s,l)=>e.jsxs("p",{style:{color:"#e74c3c",fontSize:13,margin:"4px 0"},children:["⚠ ",s]},l))}),e.jsx("button",{className:"calc-button",onClick:N,disabled:!j,children:"Calculate Triaxial"})]}),e.jsx("div",{className:"calc-main",children:a?e.jsxs("div",{className:"results-panel",children:[e.jsxs("div",{className:"results-header",children:[e.jsxs("h3",{children:["Results — ",a.length," points"]}),e.jsxs("div",{style:{display:"flex",gap:6},children:[e.jsx("button",{onClick:()=>{y(a),O("/")},style:p,children:"View on Explorer"}),e.jsx("button",{onClick:()=>L(a.map(s=>({label:`${Math.round(s.coordinates[0]*100)}:${Math.round(s.coordinates[1]*100)}:${Math.round(s.coordinates[2]*100)}`,umf:s.umf,meta:{"A%":Math.round(s.coordinates[0]*100),"B%":Math.round(s.coordinates[1]*100),"C%":Math.round(s.coordinates[2]*100)}})),"triaxial-blend.csv"),style:p,children:"CSV"}),e.jsx("button",{onClick:()=>w(a.map(s=>({label:`${Math.round(s.coordinates[0]*100)}A:${Math.round(s.coordinates[1]*100)}B:${Math.round(s.coordinates[2]*100)}C`,umf:s.umf}))),style:p,children:"Print Labels"})]})]}),e.jsx("div",{className:"results-scroll",children:e.jsxs("table",{className:"results-table",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:"#"}),e.jsx("th",{style:{color:m[0]},children:"A%"}),e.jsx("th",{style:{color:m[1]},children:"B%"}),e.jsx("th",{style:{color:m[2]},children:"C%"}),e.jsx("th",{children:"SiO₂"}),e.jsx("th",{children:"Al₂O₃"}),e.jsx("th",{children:"B₂O₃"}),e.jsx("th",{children:"Na₂O"}),e.jsx("th",{children:"K₂O"}),e.jsx("th",{children:"CaO"}),e.jsx("th",{children:"MgO"}),e.jsx("th",{children:"Si:Al"})]})}),e.jsx("tbody",{children:a.map((s,l)=>e.jsxs("tr",{children:[e.jsx("td",{children:l+1}),e.jsx("td",{children:Math.round(s.coordinates[0]*100)}),e.jsx("td",{children:Math.round(s.coordinates[1]*100)}),e.jsx("td",{children:Math.round(s.coordinates[2]*100)}),e.jsx("td",{children:t(s.umf,"SiO2")}),e.jsx("td",{children:t(s.umf,"Al2O3")}),e.jsx("td",{children:t(s.umf,"B2O3")}),e.jsx("td",{children:t(s.umf,"Na2O")}),e.jsx("td",{children:t(s.umf,"K2O")}),e.jsx("td",{children:t(s.umf,"CaO")}),e.jsx("td",{children:t(s.umf,"MgO")}),e.jsx("td",{children:D(s.umf)})]},l))})]})})]}):e.jsxs("div",{className:"empty-state",children:[e.jsx("div",{className:"icon",children:"△"}),e.jsx("p",{children:"Enter three corner recipes and hit calculate"}),e.jsxs("p",{style:{fontSize:12,color:"var(--text-dim)"},children:["Division of 5 → ",f(3,5)," points, 10 → ",f(3,10)," points"]})]})}),e.jsx("style",{children:K})]})}export{Y as TriaxialBlendPage,Y as default};
