const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/plotly-gl2d-B8_X3w7e.js","assets/vendor-react-D380Hx73.js"])))=>i.map(i=>d[i]);
import{O as v,u as H,_ as I,m as V}from"./index-CShX2zP3.js";import{r as d,j as e}from"./vendor-react-D380Hx73.js";import{c as W}from"./factory-BqgISpRP.js";import{R as K}from"./index-8HUN2i8f.js";import{s as X,a as N}from"./simplex-D8GIy9GC.js";import{g as f,r as Y}from"./umf-Bjrc84p_.js";import{a as R,f as y}from"./blend-xGiHwjeo.js";import{exportBlendCSV as Z,printLabels as q}from"./export-CZymxRhW.js";import{u as G}from"./usePageTitle-DBGH44HI.js";import{c as J}from"./calc-styles-u5C4IXOP.js";import{u as Q}from"./vendor-router-1trnvaIQ.js";import"./vendor-state-CUnBHQ16.js";function ee(l){const p=f(l,"SiO2"),c=f(l,"Al2O3"),x=f(l,"B2O3");return 1060+p*35+c*150-x*100}function te(l){const p=v.R2O.reduce((x,r)=>x+f(l,r),0),c=v.RO.reduce((x,r)=>x+f(l,r),0);return c>.001?p/c:0}function se(l,p){if(p===0)return l;const c=v.R2O.reduce((h,i)=>h+f(l,i),0),x=v.RO.reduce((h,i)=>h+f(l,i),0);if(c+x<.001)return l;const r=Math.max(-c,Math.min(x,p)),O=c>.001?(c+r)/c:1,j=x>.001?(x-r)/x:1,b={...l};for(const h of v.R2O){const i=l[h];i&&i.value>0&&(b[h]={...i,value:i.value*O})}for(const h of v.RO){const i=l[h];i&&i.value>0&&(b[h]={...i,value:i.value*j})}return b}const M=["#e74c3c","#2ecc71","#3498db"],oe=["A","B","C"];function pe(){G("Flux Triaxial");const[l,p]=d.useState([null,null,null]),[c,x]=d.useState(5),[r,O]=d.useState(0),[j,b]=d.useState(null),[h,i]=d.useState([]),{setBlendResults:F}=H(),T=Q(),[E,k]=d.useState(null),[A,D]=d.useState(!1);d.useEffect(()=>{let t=!0;return I(()=>import("./plotly-gl2d-B8_X3w7e.js").then(s=>s.p),__vite__mapDeps([0,1])).then(s=>{if(!t)return;const n=W(s.default??s);k(()=>n)}).catch(()=>{t&&D(!0)}),()=>{t=!1}},[]);const _=N(3,c),P=d.useCallback((t,s)=>{p(n=>{const u=[...n];return u[t]=s,u}),b(null)},[]),C=d.useMemo(()=>l.every(t=>t&&t.ingredients.some(s=>s.material.trim()&&s.amount>0)),[l]),B=d.useCallback(()=>{if(!C)return;i([]);const t=l,s=t.map(m=>Y(m,V)),n=s.flatMap(m=>m.errors),u=s.map(m=>m.value);if(u.some(m=>!m)){i(n.length>0?n:["Could not calculate UMF for one or more recipes"]);return}const g=u.filter(m=>m!==null),o=X({recipes:t,divisions:c},g);o.value?(b(o.value),i([...o.warnings])):i([...o.errors])},[l,c,C]),a=d.useMemo(()=>j?j.map((t,s)=>{const n=se(t.umf,r);return{index:s,coordinates:t.coordinates,umf:t.umf,shiftedUmf:n,fluxRatio:te(n),meltTemp:ee(n),boron:f(n,"B2O3"),label:`${Math.round(t.coordinates[0]*100)}A:${Math.round(t.coordinates[1]*100)}B:${Math.round(t.coordinates[2]*100)}C`,recipe:t.recipe}}):[],[j,r]),U=d.useMemo(()=>{if(a.length===0)return null;const t=a.map(o=>o.fluxRatio),s=a.map(o=>o.meltTemp),n=a.map(o=>o.boron);a.map(o=>o.label);const u=a.map(o=>`<b>${o.label}</b><br>Flux Ratio: ${o.fluxRatio.toFixed(3)}<br>Est. Temp: ${Math.round(o.meltTemp)}°C<br>B₂O₃: ${o.boron.toFixed(3)}<br>SiO₂: ${f(o.shiftedUmf,"SiO2").toFixed(2)}<br>Al₂O₃: ${f(o.shiftedUmf,"Al2O3").toFixed(2)}`),g=Math.max(...n,.01);return[{type:"scattergl",mode:"markers",x:t,y:s,text:u,hoverinfo:"text",marker:{size:a.map(o=>8+o.boron*20),color:n,colorscale:"YlOrRd",cmin:0,cmax:g,colorbar:{title:"B₂O₃",thickness:14,len:.65},line:{width:1,color:"rgba(255,255,255,0.5)"},opacity:.9}}]},[a]),z=d.useMemo(()=>{let t=0,s=1,n=1100,u=1350;if(a.length>0){const g=a.map(S=>S.fluxRatio),o=a.map(S=>S.meltTemp),m=Math.max((Math.max(...g)-Math.min(...g))*.15,.05),w=Math.max((Math.max(...o)-Math.min(...o))*.15,10);t=Math.min(...g)-m,s=Math.max(...g)+m,n=Math.min(...o)-w,u=Math.max(...o)+w}return{xaxis:{title:{text:"Flux Ratio (R₂O : RO)",font:{color:"#aaa"}},range:[t,s],gridcolor:"rgba(255,255,255,0.07)",zerolinecolor:"rgba(255,255,255,0.15)",tickfont:{color:"#888"}},yaxis:{title:{text:"Est. Melting Temperature (°C)",font:{color:"#aaa"}},range:[n,u],gridcolor:"rgba(255,255,255,0.07)",zerolinecolor:"rgba(255,255,255,0.15)",tickfont:{color:"#888"}},paper_bgcolor:"#1a1a1a",plot_bgcolor:"#111",font:{color:"#ccc"},dragmode:"pan",hovermode:"closest",margin:{l:65,r:20,t:30,b:55},annotations:[{x:.5,y:1.02,xref:"paper",yref:"paper",text:r!==0?`Flux shift: ${r>0?"+":""}${r.toFixed(2)} (R₂O ${r>0?"↑":"↓"})`:"",showarrow:!1,font:{color:"#ff9800",size:11}}]}},[a,r]),$={displayModeBar:!0,modeBarButtonsToRemove:["select2d","lasso2d","autoScale2d"],scrollZoom:!0,doubleClick:"reset"},L=d.useCallback(()=>{j&&(F(j),T("/"))},[j,F,T]);return e.jsxs("div",{className:"calc-page",children:[e.jsxs("div",{className:"calc-sidebar",onKeyDown:t=>{t.key==="Enter"&&!(t.target instanceof HTMLTextAreaElement)&&B()},children:[e.jsxs("div",{className:"calc-section",children:[e.jsx("h2",{children:"Flux Triaxial"}),e.jsx("p",{className:"subtitle",children:"Three corners blended — plotted by flux ratio vs estimated melting temperature, colored by boron."})]}),e.jsxs("div",{className:"calc-section",children:[e.jsx("h3",{children:"Corner Recipes"}),oe.map((t,s)=>e.jsx(K,{label:`Corner ${t}`,color:M[s],recipe:l[s],onChange:n=>P(s,n),compact:!0},t))]}),e.jsxs("div",{className:"calc-section",children:[e.jsx("h3",{children:"Divisions"}),e.jsx("div",{className:"calc-controls",children:e.jsxs("div",{className:"control-row",children:[e.jsx("input",{type:"range",min:"2",max:"15",value:c,onChange:t=>{x(Number(t.target.value)),b(null)}}),e.jsx("span",{className:"range-value",children:c})]})}),e.jsxs("div",{className:"point-count",children:[e.jsx("strong",{children:_})," blend points"]})]}),e.jsxs("div",{className:"calc-section",children:[e.jsxs("h3",{children:["Flux Shift",e.jsx("span",{style:{fontSize:11,color:"#888",fontWeight:400,marginLeft:8},children:r===0?"(neutral)":r>0?"→ more R₂O":"→ more RO"})]}),e.jsx("div",{className:"calc-controls",children:e.jsxs("div",{className:"control-row",children:[e.jsx("input",{type:"range",min:"-0.30",max:"0.30",step:"0.01",value:r,onChange:t=>O(Number(t.target.value)),style:{flex:1}}),e.jsxs("span",{className:"range-value",style:{minWidth:48,textAlign:"right"},children:[r>0?"+":"",r.toFixed(2)]})]})}),e.jsx("p",{style:{fontSize:11,color:"#666",margin:"4px 0 0"},children:"Shifts R₂O ↔ RO partition. Drag to watch points move."}),r!==0&&e.jsx("button",{onClick:()=>O(0),style:{...R,marginTop:4,fontSize:11,padding:"2px 10px"},children:"Reset"})]}),h.length>0&&e.jsx("div",{className:"calc-section",children:h.map((t,s)=>e.jsxs("p",{style:{color:"#e74c3c",fontSize:13,margin:"4px 0"},children:["⚠ ",t]},s))}),e.jsx("button",{className:"calc-button",onClick:B,disabled:!C,children:"Calculate Triaxial"})]}),e.jsx("div",{className:"calc-main",children:a.length>0?e.jsxs("div",{style:{display:"flex",flexDirection:"column",height:"100%",gap:0},children:[e.jsx("div",{style:{flex:"1 1 50%",minHeight:320},children:E?e.jsx(E,{data:U,layout:z,config:$,useResizeHandler:!0,style:{width:"100%",height:"100%"}}):A?e.jsx("div",{style:{display:"flex",alignItems:"center",justifyContent:"center",height:"100%",color:"#777"},children:"⚠ Chart engine failed to load"}):e.jsx("div",{style:{display:"flex",alignItems:"center",justifyContent:"center",height:"100%",color:"#777"},children:"Loading chart engine…"})}),e.jsxs("div",{className:"results-panel",style:{flex:"1 1 50%",minHeight:200,overflow:"hidden",display:"flex",flexDirection:"column"},children:[e.jsxs("div",{className:"results-header",children:[e.jsxs("h3",{children:["Results — ",a.length," points"]}),e.jsxs("div",{style:{display:"flex",gap:6},children:[e.jsx("button",{onClick:L,style:R,children:"View on Stull Map"}),e.jsx("button",{onClick:()=>Z(a.map(t=>({label:t.label,umf:t.shiftedUmf,meta:{"A%":Math.round(t.coordinates[0]*100),"B%":Math.round(t.coordinates[1]*100),"C%":Math.round(t.coordinates[2]*100),"Flux Ratio":t.fluxRatio.toFixed(3),"Est °C":Math.round(t.meltTemp),B2O3:t.boron.toFixed(3)}})),"flux-triaxial.csv"),style:R,children:"CSV"}),e.jsx("button",{onClick:()=>q(a.map(t=>({label:t.label,umf:t.shiftedUmf}))),style:R,children:"Print Labels"})]})]}),e.jsx("div",{className:"results-scroll",style:{flex:1,overflow:"auto"},children:e.jsxs("table",{className:"results-table",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:"#"}),e.jsx("th",{style:{color:M[0]},children:"A%"}),e.jsx("th",{style:{color:M[1]},children:"B%"}),e.jsx("th",{style:{color:M[2]},children:"C%"}),e.jsx("th",{children:"Flux Ratio"}),e.jsx("th",{children:"Est °C"}),e.jsx("th",{children:"B₂O₃"}),e.jsx("th",{children:"SiO₂"}),e.jsx("th",{children:"Al₂O₃"}),e.jsx("th",{children:"Na₂O"}),e.jsx("th",{children:"K₂O"}),e.jsx("th",{children:"CaO"}),e.jsx("th",{children:"MgO"})]})}),e.jsx("tbody",{children:a.map((t,s)=>e.jsxs("tr",{children:[e.jsx("td",{children:s+1}),e.jsx("td",{children:Math.round(t.coordinates[0]*100)}),e.jsx("td",{children:Math.round(t.coordinates[1]*100)}),e.jsx("td",{children:Math.round(t.coordinates[2]*100)}),e.jsx("td",{style:{fontWeight:600,color:"#ff9800"},children:t.fluxRatio.toFixed(3)}),e.jsx("td",{style:{fontWeight:600,color:"#4fc3f7"},children:Math.round(t.meltTemp)}),e.jsx("td",{style:{color:t.boron>.01?"#ffb74d":"#555"},children:t.boron.toFixed(3)}),e.jsx("td",{children:y(t.shiftedUmf,"SiO2")}),e.jsx("td",{children:y(t.shiftedUmf,"Al2O3")}),e.jsx("td",{children:y(t.shiftedUmf,"Na2O")}),e.jsx("td",{children:y(t.shiftedUmf,"K2O")}),e.jsx("td",{children:y(t.shiftedUmf,"CaO")}),e.jsx("td",{children:y(t.shiftedUmf,"MgO")})]},s))})]})})]})]}):e.jsxs("div",{className:"empty-state",children:[e.jsx("div",{className:"icon",style:{fontSize:42},children:"⚗"}),e.jsx("h3",{style:{margin:"8px 0 4px",color:"#ddd"},children:"Flux Triaxial Explorer"}),e.jsx("p",{children:"Enter three corner recipes, then calculate to see blend points plotted by flux ratio, melting temperature, and boron."}),e.jsxs("p",{style:{fontSize:12,color:"var(--text-dim)",marginTop:8},children:["Division of 5 → ",N(3,5)," points  ·  10 → ",N(3,10)," points"]}),e.jsxs("div",{style:{marginTop:16,padding:"12px 16px",background:"rgba(255,152,0,0.08)",borderRadius:8,border:"1px solid rgba(255,152,0,0.15)",maxWidth:400,fontSize:13,color:"#bbb",lineHeight:1.5},children:[e.jsx("strong",{style:{color:"#ff9800"},children:"How it works:"}),e.jsx("br",{}),"X-axis shows ",e.jsx("strong",{children:"flux ratio"})," (R₂O ÷ RO).",e.jsx("br",{}),"Y-axis shows ",e.jsx("strong",{children:"estimated melting temperature"}),".",e.jsx("br",{}),"Dot size & color show ",e.jsx("strong",{children:"boron"})," (B₂O₃).",e.jsx("br",{}),"Drag the ",e.jsx("strong",{children:"Flux Shift"})," slider to move all points."]})]})}),e.jsx("style",{children:J})]})}export{pe as FluxTriaxialPage,pe as default};
