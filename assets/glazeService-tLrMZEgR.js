import{r as B,g as T}from"./umf-DcIxpM70.js";import{y as J,m as Z}from"./index-Cx-RWLMS.js";const j={110:"clay_body",400:"slip",440:"overglaze",450:"underglaze",460:"glaze",1180:"refractory"};function X(e){try{const t=JSON.parse(e),r=t.glazes||t;if(!Array.isArray(r))throw new Error("Expected array of glazes");return r.map((s,o)=>({id:s.id||`imported_${Date.now()}_${o}`,name:s.name||`Imported Glaze ${o+1}`,source:s.source||"user",sourceUrl:s.sourceUrl,coneRange:s.coneRange||[6,6],atmosphere:s.atmosphere||"oxidation",surfaceType:s.surfaceType||"unknown",ingredients:(s.ingredients||[]).map(i=>({material:i.material||i.name,amount:i.amount||i.quantity||0,unit:"weight"})),umf:null,notes:s.notes,umfConfidence:"unknown",verified:!1}))}catch(t){return console.error("Failed to deserialize glazes JSON:",t),[]}}function Y(e){const t={exportedAt:new Date().toISOString(),count:e.length,glazes:e.map(r=>({id:r.id,name:r.name,source:r.source,sourceUrl:r.sourceUrl,coneRange:r.coneRange,atmosphere:r.atmosphere,surfaceType:r.surfaceType,ingredients:r.ingredients,notes:r.notes}))};return JSON.stringify(t,null,2)}function K(e){const t=e.trim().split(`
`);if(t.length<2)return[];const r=t[0].split(",").map(o=>o.trim().toLowerCase()),s=[];for(let o=1;o<t.length;o++){const i=t[o].split(",").map(a=>a.trim()),c={};r.forEach((a,n)=>{c[a]=i[n]||""});const f=[];for(const[a,n]of Object.entries(c)){if(["name","cone","atmosphere","surface","notes","source"].includes(a))continue;const u=parseFloat(n);!isNaN(u)&&u>0&&f.push({material:a,amount:u,unit:"weight"})}f.length>0&&s.push({id:`csv_${Date.now()}_${o}`,name:c.name||`CSV Import ${o}`,source:"user",coneRange:[c.cone||"6",c.cone||"6"],atmosphere:c.atmosphere||"oxidation",surfaceType:c.surface||"unknown",ingredients:f,umf:null,notes:c.notes,umfConfidence:"unknown",verified:!1})}return s}function W(e){var a;const r=new DOMParser().parseFromString(e,"text/xml"),s=r.querySelector("parsererror");if(s)throw new Error(`Invalid XML: ${(a=s.textContent)==null?void 0:a.slice(0,120)}`);const o=[],i=r.querySelectorAll("recipe, Recipe, RECIPE"),c=r.querySelectorAll("glaze, Glaze, GLAZE"),f=i.length>0?i:c;if(f.length>0)f.forEach((n,u)=>{const y=F(n,u);y&&o.push(y)});else{const n=F(r.documentElement,0);n&&o.push(n)}return o}function O(e){var t;return((t=e==null?void 0:e.textContent)==null?void 0:t.trim())??""}function F(e,t){const r=O(e.querySelector("name, Name, title, Title"))||`Insight Import ${t+1}`,s=[];if(e.querySelectorAll("ingredient, Ingredient, material, Material, component, Component").forEach(l=>{const p=O(l.querySelector("name, Name, material, Material"))||l.getAttribute("name")||l.getAttribute("material")||"",d=O(l.querySelector("amount, Amount, quantity, Quantity, percent, Percent"))||l.getAttribute("amount")||l.getAttribute("percent")||"",h=parseFloat(d);(l.getAttribute("addition")||O(l.querySelector("addition"))).toLowerCase(),p&&!isNaN(h)&&h>0&&s.push({material:p,amount:h,unit:"weight",confidence:"declared"})}),s.length===0)return null;const i=e.querySelector("umf, UMF, analysis, Analysis"),c={};if(i){const l=i.children;for(let p=0;p<l.length;p++){const d=l[p],h=d.tagName,g=parseFloat(d.textContent??"");!isNaN(g)&&g>0&&(c[h]={value:g,precision:4,state:"declared",source:"insight_xml"})}}const f=O(e.querySelector("cone, Cone, temperature, Temperature"))||"",a=parseFloat(f),n=isNaN(a)?f?[f,f]:["?","?"]:[a,a],u=O(e.querySelector("atmosphere, Atmosphere, firing, Firing"))||"unknown",y=O(e.querySelector("surface, Surface, finish, Finish"))||"unknown",m=O(e.querySelector("notes, Notes, description, Description"));return{id:`insight_${Date.now()}_${t}`,name:r,source:"user",ingredients:s,umf:Object.keys(c).length>0?c:null,coneRange:n,atmosphere:u,surfaceType:y,notes:m||void 0,umfConfidence:Object.keys(c).length>0?"declared":"unknown",verified:!1}}const Q=["SiO2","Al2O3","B2O3","Li2O","Na2O","K2O","CaO","MgO","BaO","SrO","ZnO","MnO","Fe2O3","TiO2","ZrO2","P2O5","V2O5","Cr2O3","NiO","CuO","CoO","SnO2"],H={1:"gloss",2:"satin",3:"matte",4:"unknown",5:"crystalline",6:"crawl"},ee={1:"transparent",2:"translucent",3:"opaque"},te={1:"oxidation",2:"reduction",3:"neutral"};function E(e){const t=[];let r="",s=!1;for(let o=0;o<e.length;o++){const i=e[o];i==='"'?s&&e[o+1]==='"'?(r+='"',o++):s=!s:i===","&&!s?(t.push(r.trim()),r=""):r+=i}return t.push(r.trim()),t}function ne(e){const t=e.toLowerCase();return t.includes("sio2_umf")||t.includes("from_orton_cone")||t.includes("material_type_concatenated")}function re(e){var c,f;const t=e.split(`
`).filter(a=>a.trim().length>0);if(t.length<2)return[];const r=E(t[0]),s={};r.forEach((a,n)=>{s[a.trim().toLowerCase()]=n});const o=(a,n)=>{const u=s[n.toLowerCase()];return u!==void 0?a[u]??"":""},i=[];for(let a=1;a<t.length;a++)try{const n=E(t[a]);if(n.length<5)continue;const u=o(n,"id")||`glazy_csv_${a}`,y=o(n,"name")||`Glazy #${u}`,m={};let l=!1;for(const N of Q){const S=parseFloat(o(n,`${N}_umf`));!isNaN(S)&&S>0&&(m[N]={value:S,precision:4,state:"inferred",source:"glazy_csv"},l=!0)}if(!l)continue;const p=((c=m.SiO2)==null?void 0:c.value)??0,d=((f=m.Al2O3)==null?void 0:f.value)??0,h=["Li2O","Na2O","K2O"].reduce((N,S)=>{var _;return N+(((_=m[S])==null?void 0:_.value)??0)},0),g=["CaO","MgO","BaO","SrO","ZnO","MnO"].reduce((N,S)=>{var _;return N+(((_=m[S])==null?void 0:_.value)??0)},0);m._meta={SiO2_Al2O3_ratio:d>.001?p/d:0,R2O_RO_ratio:g>.001?h/g:0,fluxTotal:h+g};const w=o(n,"from_orton_cone"),b=o(n,"to_orton_cone"),x=[w||"?",b||w||"?"],q=parseInt(o(n,"surface_type"),10),G=H[q]||"unknown",L=parseInt(o(n,"transparency_type"),10),$=ee[L]||void 0,k=parseInt(o(n,"atmosphere"),10),U=te[k]||"unknown",z=parseInt(o(n,"base_type_id"),10),C=isNaN(z)?460:z,A=parseInt(o(n,"type_id"),10),D=isNaN(A)?null:A,I=parseInt(o(n,"subtype_id"),10),v=isNaN(I)?null:I,V=v??D??J(y),P=o(n,"country")||void 0;i.push({id:`glazy_${u}`,name:y,source:"glazy",sourceUrl:`https://glazy.org/recipes/${u}`,ingredients:[],umf:m,coneRange:x,atmosphere:U,surfaceType:G,transparency:$,baseType:j[C]??"glaze",baseTypeId:C,glazeTypeId:V,subtypeId:v,country:P,umfConfidence:"inferred",verified:!1})}catch{}return i}function M(e){return X(e)}function ce(e){return Y(e)}function R(e){const t=e.split(`
`)[0]??"";return ne(t)?re(e):K(e)}function oe(e){return W(e)}function ue(e,t){const r=t.toLowerCase();if(r.endsWith(".xml"))return oe(e);if(r.endsWith(".csv"))return R(e);if(r.endsWith(".json"))return M(e);try{return M(e)}catch{}try{return R(e)}catch{}return[]}function le(e){const t=[];for(const r of e){const s=B(r,Z);s.value?t.push({...r,umf:s.value,umfConfidence:s.confidence}):t.push({...r})}return t}const se=["SiO2","Al2O3","B2O3","Na2O","K2O","CaO","MgO","ZnO","SrO","BaO"];function fe(e,t,r){const{weights:s={},count:o=6,oxides:i=se}=r,c=e.umf;if(!c)return[];const f=i.map(n=>T(c,n)||0),a=i.map(n=>s[n]??1);return t.filter(n=>n.id!==e.id).map(n=>{const u=n.umf;if(!u)return null;const y=i.map(l=>T(u,l)||0),m=Math.sqrt(y.reduce((l,p,d)=>l+a[d]*(p-f[d])**2,0));return{glaze:n,dist:m}}).filter(n=>n!==null).sort((n,u)=>n.dist-u.dist).slice(0,o)}export{j as B,ue as a,M as b,le as c,oe as d,ce as e,fe as f,R as i};
