import{r as m,j as e}from"./vendor-react-D380Hx73.js";import{R as P}from"./index-CKJkX_Fm.js";import{r as B,g as C}from"./umf-Bpe2KrgL.js";import{r as A,u as E,m as k}from"./index-Beyst0Xe.js";import{a as O}from"./blend-xGiHwjeo.js";import{exportBlendCSV as F,printLabels as z}from"./export-CUxvy3P4.js";import{u as M}from"./usePageTitle-DBGH44HI.js";import{c as T}from"./calc-styles-u5C4IXOP.js";import{u as D}from"./vendor-router-1trnvaIQ.js";import"./vendor-state-CUnBHQ16.js";function I(n){return{...n,ingredients:n.ingredients.map(y=>({...y})),umf:n.umf?{...n.umf}:null,coneRange:[...n.coneRange]}}function L(n,y,i,u,j){const N=[],x=[],f=[],h=[];h.push({index:0,coordinates:new Array(i.length).fill(0),recipe:n,umf:y,label:"center"});let o=1;for(let g=0;g<i.length;g++){const d=i[g];for(let b=1;b<=u;b++){const R=b/u,v=d.min+(d.max-d.min)*R,S=new Array(i.length).fill(0);S[g]=v;const p=I(n);p.id=`radial_${Date.now()}_${o}`,p.ingredients.push({material:d.materialName,materialId:d.material.id,amount:v,unit:"weight"}),p.name=`${n.name} +${A(v,1)} ${d.materialName}`;const c=B(p,j);h.push({index:o,coordinates:S,recipe:p,umf:c.value||{},label:`${d.materialName.substring(0,3)}:${A(v,1)}`}),o++}}return N.push({operation:"radial_complete",inputs:{center:n.name,spokes:i.length,stepsPerSpoke:u},output:h.length,note:`Generated ${h.length} radial points (1 center + ${i.length} spokes × ${u} steps)`}),{value:h,confidence:"inferred",warnings:x,errors:f,trace:N}}const V=[{material:"",maxPercent:10},{material:"",maxPercent:10}];function ee(){M("Radial Blend");const[n,y]=m.useState(null),[i,u]=m.useState(V),[j,N]=m.useState(5),[x,f]=m.useState(null),[h,o]=m.useState([]),{setBlendResults:g}=E(),d=D(),b=m.useCallback((t,a)=>{u(s=>{const l=[...s];return l[t]={...l[t],...a},l}),f(null)},[]),R=m.useCallback(()=>{u(t=>[...t,{material:"",maxPercent:10}]),f(null)},[]),v=m.useCallback(t=>{u(a=>a.filter((s,l)=>l!==t)),f(null)},[]),S=n&&n.ingredients.some(t=>t.material.trim()&&t.amount>0)&&i.length>0&&i.every(t=>t.material.trim()&&t.maxPercent>0),p=m.useCallback(()=>{if(!n)return;o([]);const t=B(n,k);if(!t.value){o(t.errors.length>0?t.errors:["Failed to calculate center UMF"]);return}const a=i.map(r=>{const $=k.resolve(r.material);return{input:r,material:$}}),s=a.filter(r=>!r.material);if(s.length>0){o(s.map(r=>`Unknown material: ${r.input.material}`));return}const l=L(n,t.value,a.map(r=>({material:r.material,materialName:r.material.primaryName,min:0,max:r.input.maxPercent,steps:j})),j,k);l.value?(f(l.value),o(l.warnings)):o(l.errors)},[n,i,j]),c=(t,a)=>{const s=C(t,a);return!s||Number.isNaN(s)?"—":s.toFixed(3)};return e.jsxs("div",{className:"calc-page",children:[e.jsxs("div",{className:"calc-sidebar",onKeyDown:t=>{t.key==="Enter"&&!(t.target instanceof HTMLTextAreaElement)&&p()},children:[e.jsxs("div",{className:"calc-section",children:[e.jsx("h2",{children:"Radial Blend"}),e.jsx("p",{className:"subtitle",children:"Center recipe with spokes out to each addition max"})]}),e.jsxs("div",{className:"calc-section",children:[e.jsx("h3",{children:"Center Recipe"}),e.jsx(P,{label:"Center Glaze",color:"#6366F1",recipe:n,onChange:y})]}),e.jsxs("div",{className:"calc-section",children:[e.jsx("h3",{children:"Additions (spokes)"}),i.map((t,a)=>e.jsxs("div",{style:{display:"flex",gap:8,alignItems:"end",marginBottom:8},children:[e.jsx("div",{style:{flex:1},children:e.jsx("input",{type:"text",value:t.material,onChange:s=>b(a,{material:s.target.value}),placeholder:"Material name...",list:"common-materials",style:w})}),e.jsxs("div",{style:{width:90},children:[e.jsx("label",{style:{fontSize:11,color:"var(--text-secondary)",display:"block",marginBottom:2},children:"Max %"}),e.jsx("input",{type:"number",value:t.maxPercent,onChange:s=>b(a,{maxPercent:parseFloat(s.target.value)||0}),min:1,max:50,step:1,style:w})]}),i.length>1&&e.jsx("button",{onClick:()=>v(a),style:U,children:"Remove"})]},a)),e.jsx("button",{onClick:R,style:_,children:"+ Add Addition"})]}),e.jsxs("div",{className:"calc-section",children:[e.jsx("h3",{children:"Steps per Spoke"}),e.jsx("div",{className:"calc-controls",children:e.jsxs("div",{className:"control-row",children:[e.jsx("input",{type:"range",min:"2",max:"10",value:j,onChange:t=>N(Number(t.target.value))}),e.jsx("span",{className:"range-value",children:j})]})})]}),h.length>0&&e.jsx("div",{className:"calc-section",children:h.map((t,a)=>e.jsxs("p",{style:{color:"#e74c3c",fontSize:13,margin:"4px 0"},children:["⚠ ",t]},a))}),e.jsx("button",{className:"calc-button",onClick:p,disabled:!S,children:"Generate Radial Blend"})]}),e.jsx("div",{className:"calc-main",children:x?e.jsxs("div",{className:"results-panel",children:[e.jsxs("div",{className:"results-header",children:[e.jsxs("h3",{children:["Results — ",x.length," points"]}),e.jsxs("div",{style:{display:"flex",gap:6},children:[e.jsx("button",{onClick:()=>{const t=x.map((a,s)=>({index:s,coordinates:[1,0,0],recipe:a.recipe,umf:a.umf,label:a.label}));g(t),d("/")},style:O,children:"View on Explorer"}),e.jsx("button",{onClick:()=>F(x.map((t,a)=>({label:t.label||`S${a+1}`,umf:t.umf,meta:t.coordinates.reduce((s,l,r)=>(s[`A${r+1}`]=l,s),{})})),"radial-blend.csv"),style:O,children:"CSV"}),e.jsx("button",{onClick:()=>z(x.map(t=>({label:t.label||"Radial",umf:t.umf,recipe:t.recipe}))),style:O,children:"Print Labels"})]})]}),e.jsx("div",{className:"results-scroll",children:e.jsxs("table",{className:"results-table",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:"#"}),e.jsx("th",{children:"Label"}),e.jsx("th",{children:"SiO2"}),e.jsx("th",{children:"Al2O3"}),e.jsx("th",{children:"B2O3"}),e.jsx("th",{children:"Na2O"}),e.jsx("th",{children:"K2O"}),e.jsx("th",{children:"CaO"}),e.jsx("th",{children:"MgO"}),e.jsx("th",{children:"ZnO"}),e.jsx("th",{children:"Si:Al"})]})}),e.jsx("tbody",{children:x.map((t,a)=>{const s=C(t.umf,"SiO2"),l=C(t.umf,"Al2O3"),r=l>0?(s/l).toFixed(1):"—";return e.jsxs("tr",{children:[e.jsx("td",{children:a+1}),e.jsx("td",{children:t.label}),e.jsx("td",{children:c(t.umf,"SiO2")}),e.jsx("td",{children:c(t.umf,"Al2O3")}),e.jsx("td",{children:c(t.umf,"B2O3")}),e.jsx("td",{children:c(t.umf,"Na2O")}),e.jsx("td",{children:c(t.umf,"K2O")}),e.jsx("td",{children:c(t.umf,"CaO")}),e.jsx("td",{children:c(t.umf,"MgO")}),e.jsx("td",{children:c(t.umf,"ZnO")}),e.jsx("td",{children:r})]},a)})})]})})]}):e.jsxs("div",{className:"empty-state",children:[e.jsx("div",{className:"icon",children:"*"}),e.jsx("p",{children:"Enter a center recipe and additions, then generate"}),e.jsx("p",{style:{fontSize:12,color:"var(--text-dim)"},children:"Each addition creates a spoke from 0 to max"})]})}),e.jsx("style",{children:T})]})}const w={background:"var(--bg-tertiary)",border:"1px solid var(--border-primary)",borderRadius:6,padding:"8px 10px",color:"var(--text-bright)",fontSize:13,width:"100%"},_={padding:"6px 10px",background:"var(--bg-tertiary)",border:"1px solid var(--border-secondary)",borderRadius:6,color:"#aaa",fontSize:12,cursor:"pointer"},U={padding:"6px 10px",background:"#2a1515",border:"1px solid #553",borderRadius:6,color:"#e74c3c",fontSize:11,cursor:"pointer"};export{ee as RadialBlendPage,ee as default};
