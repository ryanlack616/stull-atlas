import{r as l,j as t}from"./vendor-react-D0vdeqNS.js";import{m as f}from"./index-DFhyK2mv.js";let p=1;const F=["Custer Feldspar","Nepheline Syenite","Minspar 200","G200 HP Feldspar","Wollastonite","EPK Kaolin","Silica","Dolomite","Talc","Whiting","Gerstley Borate","Frit 3134","Frit 3110","Frit 3124","Frit 3195","Spodumene","Petalite","Bone Ash","Zinc Oxide","Barium Carbonate","Ball Clay","Red Iron Oxide","Tin Oxide","Titanium Dioxide","Rutile","Cobalt Carbonate","Copper Carbonate","Manganese Dioxide","Zircopax","Lithium Carbonate","Bentonite","Colemanite"];function S(o){return{id:`input_${Date.now()}_${Math.random().toString(36).substr(2,6)}`,name:o,source:"user",ingredients:[{material:"",amount:0,unit:"weight"}],umf:null,coneRange:[6,6],atmosphere:"oxidation",surfaceType:"unknown",umfConfidence:"unknown",verified:!1}}const L=(()=>{try{return f.getAllMaterials().map(o=>o.primaryName).sort()}catch{return F}})();function E(o){if(!o.trim())return{resolved:!1};const c=f.resolve(o.trim());return c?{resolved:!0,match:c.primaryName,discontinued:c.discontinued}:{resolved:!1}}function _({label:o,color:c,recipe:j,onChange:a,compact:b,datalistId:y}){const N=l.useId(),h=y||`materials-${N}`,u=l.useRef(new Map),C=l.useCallback((e,i)=>{const r=u.current;return r.has(e)||r.set(e,p++),r.get(e)},[]),m=l.useRef(null);m.current||(m.current=S(o));const n=j||m.current,x=l.useCallback((e,i,r)=>{const s={...n};s.ingredients=[...n.ingredients],s.ingredients[e]={...s.ingredients[e],[i]:r},a(s)},[n,a]),R=l.useCallback(()=>{const e={...n};e.ingredients=[...n.ingredients,{material:"",amount:0,unit:"weight"}],u.current.set(e.ingredients.length-1,p++),a(e)},[n,a]),M=l.useCallback(e=>{if(n.ingredients.length<=1)return;const i={...n};i.ingredients=n.ingredients.filter((d,A)=>A!==e);const r=u.current,s=new Map;let v=0;for(let d=0;d<n.ingredients.length;d++)d!==e&&(s.set(v,r.get(d)??p++),v++);u.current=s,a(i)},[n,a]),k=l.useCallback(e=>{a({...n,name:e})},[n,a]),I=l.useCallback(e=>{const i=parseInt(e,10)||6;a({...n,coneRange:[i,i]})},[n,a]),w=l.useCallback(e=>{a({...n,atmosphere:e})},[n,a]),g=n.ingredients.reduce((e,i)=>e+(i.amount||0),0);return t.jsxs("div",{className:"recipe-input",style:{"--accent":c||"#6366F1"},children:[t.jsxs("div",{className:"recipe-header",children:[t.jsx("div",{className:"recipe-label",style:{borderLeftColor:c||"#6366F1"},children:t.jsx("input",{type:"text",value:n.name,onChange:e=>k(e.target.value),placeholder:o,className:"name-input"})}),!b&&t.jsxs("div",{className:"recipe-meta",children:[t.jsxs("label",{children:["Cone",t.jsx("select",{value:String(n.coneRange[0]),onChange:e=>I(e.target.value),children:["04","03","02","01","0","1","2","3","4","5","6","7","8","9","10"].map(e=>t.jsx("option",{value:e,children:e},e))})]}),t.jsxs("label",{children:["Atm",t.jsxs("select",{value:n.atmosphere,onChange:e=>w(e.target.value),children:[t.jsx("option",{value:"oxidation",children:"Ox"}),t.jsx("option",{value:"reduction",children:"Red"}),t.jsx("option",{value:"neutral",children:"Neut"})]})]})]})]}),t.jsx("div",{className:"ingredients-list",children:n.ingredients.map((e,i)=>{const r=E(e.material);return t.jsxs("div",{className:"ingredient-row",children:[t.jsxs("div",{style:{flex:1,position:"relative"},children:[t.jsx("input",{type:"text",value:e.material,onChange:s=>x(i,"material",s.target.value),placeholder:"Material...",className:"material-input",list:h,style:{borderColor:e.material.trim()?r.resolved?r.discontinued?"#b45309":"var(--border-secondary)":"#991b1b":void 0,width:"100%"}}),e.material.trim()&&t.jsx("div",{style:{fontSize:10,marginTop:1,minHeight:14},children:r.resolved?t.jsxs(t.Fragment,{children:[t.jsx("span",{style:{color:"#4caf50"},children:"✓"}),r.match!==e.material.trim()&&t.jsxs("span",{style:{color:"var(--text-muted)",marginLeft:4},children:["→ ",r.match]}),r.discontinued&&t.jsx("span",{style:{color:"#f59e0b",marginLeft:4},children:"⚠ discontinued"})]}):t.jsx("span",{style:{color:"#ef4444"},children:"✗ unknown material"})})]}),t.jsx("input",{type:"number",value:e.amount||"",onChange:s=>x(i,"amount",parseFloat(s.target.value)||0),placeholder:"0",min:"0",step:"0.1",className:"amount-input"}),t.jsx("button",{className:"remove-btn",onClick:()=>M(i),title:"Remove ingredient",disabled:n.ingredients.length<=1,children:"×"})]},C(i,n.ingredients.length))})}),t.jsxs("div",{className:"recipe-footer",children:[t.jsx("button",{className:"add-btn",onClick:R,children:"+ Add Material"}),t.jsxs("span",{className:"total",style:{color:Math.abs(g-100)<.5?"#4caf50":"#888"},children:["Σ ",g.toFixed(1)]})]}),t.jsx("datalist",{id:h,children:L.map(e=>t.jsx("option",{value:e},e))})]})}export{_ as R};
