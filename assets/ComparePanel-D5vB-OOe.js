import{r as w,j as e,R as T}from"./vendor-react-D380Hx73.js";import{U as _,F as A,O as k}from"./OxideRadar-BRo5lEwo.js";import{G as B,C as M}from"./ExplorerPage-CWrdHk9V.js";import"./index-DUKXpxkf.js";import{a as g}from"./OxideLink-DfHeNf4K.js";import"./umf-Bx7e6FOm.js";import"./validation-BBji9Y6-.js";import"./glazeService-CW_f59Iq.js";import"./export-BPAFPFXr.js";import"./vendor-state-CUnBHQ16.js";import"./vendor-router-1trnvaIQ.js";import"./usePageTitle-DBGH44HI.js";import"./domain-digitalfire-DfgmtSpv.js";import"./data-digitalfire-CCT-bSzB.js";function U({value:a,max:h,color:j}){const f=h>0?Math.min(a/h*100,100):0;return e.jsx("div",{style:{width:"100%",height:3,background:"var(--bg-tertiary)",borderRadius:2,marginTop:2,overflow:"hidden"},children:e.jsx("div",{style:{width:`${f}%`,height:"100%",background:j,borderRadius:2,transition:"width 0.3s ease"}})})}function X({glazes:a,onRemove:h,onClear:j,onSelect:f}){const[S,O]=w.useState(!1),[b,v]=w.useState(!0);if(a.length===0)return e.jsxs("div",{className:"compare-empty",children:[e.jsx("p",{children:"No glazes selected for comparison."}),e.jsx("p",{style:{fontSize:12,color:"var(--text-muted)"},children:'Click a glaze in the Detail tab and press "Add to Compare" to start comparing up to 3 glazes side-by-side.'})]});const x=[{label:"Fluxes (Râ‚‚O)",oxides:["Li2O","Na2O","K2O"]},{label:"Fluxes (RO)",oxides:["CaO","MgO","ZnO","BaO","SrO"]},{label:"Stabilizers",oxides:["Al2O3","B2O3","Fe2O3"]},{label:"Glass Formers",oxides:["SiO2","TiO2","ZrO2"]}],u=new Set;a.forEach(t=>{const r=t.umf;r&&x.forEach(n=>{n.oxides.forEach(c=>{var m;(((m=r[c])==null?void 0:m.value)??0)>.001&&u.add(c)})})});const C=()=>{const t=["",...a.map(s=>s.name)],r=[];r.push(["Cone",...a.map(s=>`${s.coneRange[0]}â€“${s.coneRange[1]}`)]),r.push(["Surface",...a.map(s=>s.surfaceType)]),r.push(["Atmosphere",...a.map(s=>s.atmosphere)]),x.forEach(s=>{const i=s.oxides.filter(d=>u.has(d));i.length!==0&&(r.push([`â€” ${s.label} â€”`]),i.forEach(d=>{r.push([d,...a.map(p=>{var R,y;return(((y=(R=p.umf)==null?void 0:R[d])==null?void 0:y.value)??0).toFixed(3)})])}))});const n=a.map(s=>{var i;return(i=s.umf)==null?void 0:i._meta});n.some(s=>s)&&(r.push(["â€” Ratios â€”"]),r.push(["Si:Al",...n.map(s=>{var i;return((i=s==null?void 0:s.SiO2_Al2O3_ratio)==null?void 0:i.toFixed(2))??"â€”"})]),r.push(["Râ‚‚O:RO",...n.map(s=>{var i;return((i=s==null?void 0:s.R2O_RO_ratio)==null?void 0:i.toFixed(2))??"â€”"})]));const c=new Set;a.forEach(s=>s.ingredients.forEach(i=>c.add(i.material))),r.push(["â€” Recipe â€”"]),c.forEach(s=>{r.push([s,...a.map(i=>{const d=i.ingredients.find(p=>p.material===s);return d?d.amount.toFixed(1):"â€”"})])});const m=t.map((s,i)=>{var d;return Math.max(((d=t[i])==null?void 0:d.length)??0,...r.map(p=>(p[i]??"").length))}),o=t.map((s,i)=>s.padEnd(m[i])).join("  "),l=r.map(s=>t.map((i,d)=>(s[d]??"").padEnd(m[d])).join("  ")).join(`
`);return o+`
`+l},N=()=>{const t=o=>`"${o.replace(/"/g,'""')}"`,r=["",...a.map(o=>t(o.name))],n=[];n.push(["Cone",...a.map(o=>`${o.coneRange[0]}-${o.coneRange[1]}`)]),n.push(["Surface",...a.map(o=>t(o.surfaceType))]),n.push(["Atmosphere",...a.map(o=>t(o.atmosphere))]),x.forEach(o=>{o.oxides.filter(l=>u.has(l)).forEach(l=>{n.push([l,...a.map(s=>{var i,d;return(((d=(i=s.umf)==null?void 0:i[l])==null?void 0:d.value)??0).toFixed(3)})])})});const c=a.map(o=>{var l;return(l=o.umf)==null?void 0:l._meta});n.push(["Si:Al",...c.map(o=>{var l;return((l=o==null?void 0:o.SiO2_Al2O3_ratio)==null?void 0:l.toFixed(2))??""})]),n.push(["R2O:RO",...c.map(o=>{var l;return((l=o==null?void 0:o.R2O_RO_ratio)==null?void 0:l.toFixed(2))??""})]);const m=new Set;return a.forEach(o=>o.ingredients.forEach(l=>m.add(l.material))),m.forEach(o=>{n.push([t(o),...a.map(l=>{const s=l.ingredients.find(i=>i.material===o);return s?s.amount.toFixed(1):""})])}),[r.join(","),...n.map(o=>o.join(","))].join(`
`)},F=async()=>{await navigator.clipboard.writeText(C()),O(!0),setTimeout(()=>O(!1),2e3)},E=()=>{const t=new Blob([N()],{type:"text/csv"}),r=URL.createObjectURL(t),n=document.createElement("a");n.href=r,n.download=`stull-compare-${a.length}-glazes.csv`,n.click(),URL.revokeObjectURL(r)};return e.jsxs("div",{className:"comparison-panel",children:[e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:12},children:[e.jsxs("h4",{style:{margin:0,fontSize:12,textTransform:"uppercase",color:"var(--text-secondary)"},children:["Comparing ",a.length," Glaze",a.length>1?"s":""]}),e.jsxs("div",{style:{display:"flex",gap:4},children:[e.jsx("button",{onClick:()=>v(!b),className:"compare-clear-btn",title:"Toggle visual bars",children:b?"â–® Bars":"â–¯ Bars"}),e.jsx("button",{onClick:F,className:"compare-clear-btn",title:"Copy comparison as text",children:S?"âœ“ Copied":"ðŸ“‹ Copy"}),e.jsx("button",{onClick:E,className:"compare-clear-btn",title:"Download as CSV",children:"ðŸ“¥ CSV"}),e.jsx("button",{onClick:j,className:"compare-clear-btn",children:"Clear All"})]})]}),e.jsxs("table",{className:"compare-table",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{}),a.map(t=>e.jsxs("th",{children:[e.jsx("button",{className:"compare-name-btn",onClick:()=>f(t),title:"View details",children:t.name}),e.jsx("button",{className:"compare-remove",onClick:()=>h(t.id),title:"Remove",children:"Ã—"})]},t.id))]})}),e.jsxs("tbody",{children:[e.jsxs("tr",{className:"compare-meta-row",children:[e.jsx("td",{children:"Type"}),a.map(t=>e.jsx("td",{children:e.jsx(B,{glazeTypeId:t.glazeTypeId,size:"sm"})},t.id))]}),e.jsxs("tr",{className:"compare-meta-row",children:[e.jsx("td",{children:"Cone"}),a.map(t=>e.jsx("td",{children:e.jsx(M,{coneRange:t.coneRange,width:100,height:16})},t.id))]}),e.jsxs("tr",{className:"compare-meta-row",children:[e.jsx("td",{children:"Surface"}),a.map(t=>e.jsx("td",{children:t.surfaceType},t.id))]}),e.jsxs("tr",{className:"compare-meta-row",children:[e.jsx("td",{children:"Atmosphere"}),a.map(t=>e.jsx("td",{children:t.atmosphere},t.id))]}),e.jsxs("tr",{className:"compare-meta-row",children:[e.jsx("td",{children:"UMF"}),a.map(t=>{const r=t.umf;return e.jsx("td",{children:r?e.jsx(_,{umf:r,width:100,compact:!0}):"â€”"},t.id)})]}),e.jsxs("tr",{className:"compare-meta-row",children:[e.jsx("td",{children:"Fluxes"}),a.map(t=>{const r=t.umf;return e.jsx("td",{children:r?e.jsx(A,{umf:r,size:64}):"â€”"},t.id)})]}),e.jsxs("tr",{className:"compare-meta-row",children:[e.jsx("td",{children:"Profile"}),a.map((t,r)=>{const n=t.umf,c=r>0?a[0].umf??void 0:void 0;return e.jsx("td",{children:n?e.jsx(k,{umf:n,compareUmf:c,size:100}):"â€”"},t.id)})]}),x.map(t=>{const r=t.oxides.filter(n=>u.has(n));return r.length===0?null:e.jsxs(T.Fragment,{children:[e.jsx("tr",{className:"compare-group-row",children:e.jsx("td",{colSpan:a.length+1,children:t.label})}),r.map(n=>{const c=a.map(i=>{var d,p;return((p=(d=i.umf)==null?void 0:d[n])==null?void 0:p.value)??0}),m=Math.max(...c),o=Math.min(...c),l=m-o,s=["#3498db","#e67e22","#2ecc71"];return e.jsxs("tr",{children:[e.jsx(g,{oxide:n}),c.map((i,d)=>e.jsxs("td",{className:"compare-value",style:{fontWeight:a.length>1&&i===m&&m!==o?600:400,color:a.length>1&&i===m&&m!==o?"var(--accent)":"var(--text-primary)"},children:[i.toFixed(3),a.length>1&&l>.01&&e.jsx("span",{style:{fontSize:9,marginLeft:3,color:i===m?"rgba(76,175,80,0.7)":i===o?"rgba(244,67,54,0.6)":"var(--text-dim)"},children:i===m?"â–²":i===o?"â–¼":""}),b&&e.jsx(U,{value:i,max:m||1,color:s[d%s.length]})]},a[d].id))]},n)})]},t.label)}),(()=>{const t=a.map(r=>{var n;return(n=r.umf)==null?void 0:n._meta});return t.every(r=>!r)?null:e.jsxs(e.Fragment,{children:[e.jsx("tr",{className:"compare-group-row",children:e.jsx("td",{colSpan:a.length+1,children:"Ratios"})}),e.jsxs("tr",{children:[e.jsx("td",{children:"Si:Al"}),t.map((r,n)=>{var c;return e.jsx("td",{className:"compare-value",children:((c=r==null?void 0:r.SiO2_Al2O3_ratio)==null?void 0:c.toFixed(2))??"â€”"},a[n].id)})]}),e.jsxs("tr",{children:[e.jsx("td",{children:"Râ‚‚O:RO"}),t.map((r,n)=>{var c;return e.jsx("td",{className:"compare-value",children:((c=r==null?void 0:r.R2O_RO_ratio)==null?void 0:c.toFixed(2))??"â€”"},a[n].id)})]})]})})(),e.jsx("tr",{className:"compare-group-row",children:e.jsx("td",{colSpan:a.length+1,children:"Recipe"})}),(()=>{const t=new Set;return a.forEach(r=>r.ingredients.forEach(n=>t.add(n.material))),Array.from(t).map(r=>e.jsxs("tr",{children:[e.jsx("td",{style:{fontSize:11},children:r}),a.map(n=>{const c=n.ingredients.find(m=>m.material===r);return e.jsx("td",{className:"compare-value",children:c?c.amount.toFixed(1):"â€”"},n.id)})]},r))})()]})]})]})}export{X as ComparePanel};
