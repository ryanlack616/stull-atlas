import{r as f,j as n}from"./vendor-react-D380Hx73.js";import{g as O,c as S}from"./umf-Bpe2KrgL.js";import{F as D,E as y,a as _,r as E,u as G}from"./index-Beyst0Xe.js";import{a as N,b as K}from"./blend-xGiHwjeo.js";import{exportBlendCSV as X,printLabels as Z}from"./export-CUxvy3P4.js";import{u as Q}from"./usePageTitle-DBGH44HI.js";import{c as W}from"./calc-styles-u5C4IXOP.js";import{u as Y}from"./vendor-router-1trnvaIQ.js";import"./vendor-state-CUnBHQ16.js";function J(a){return()=>{let s=a+=1831565813;return s=Math.imul(s^s>>>15,s|1),s^=s+Math.imul(s^s>>>7,s|61),((s^s>>>14)>>>0)/4294967296}}function ee(a,s){const t=[...a];for(let c=t.length-1;c>0;c--){const o=Math.floor(s()*(c+1));[t[c],t[o]]=[t[o],t[c]]}return t}function ne(a,s,t=42){const c=J(t),o=Object.keys(a),p=[],x={};for(const r of o){const{min:l,max:u}=a[r],d=[];for(let m=0;m<s;m++){const v=l+(u-l)*(m/s),g=l+(u-l)*((m+1)/s);d.push(v+c()*(g-v))}x[r]=ee(d,c)}for(let r=0;r<s;r++){const l={},u={};for(const d of o){const m=x[d][r];u[d]=m,l[d]=S(m,"inferred",`LHS sample ${r}`)}p.push({index:r,umf:M(l),coordinates:u})}return p}function se(a,s){const t=Object.keys(a),c=[];for(let o=0;o<s;o++){const p={},x={};for(let r=0;r<t.length;r++){const l=t[r],{min:u,max:d}=a[l],m=I(r),v=F(o+1,m),g=u+v*(d-u);x[l]=g,p[l]=S(g,"inferred",`Sobol sample ${o}`)}c.push({index:o,umf:M(p),coordinates:x})}return c}function te(a,s){const t=Object.keys(a),c=[];for(let o=0;o<s;o++){const p={},x={};for(let r=0;r<t.length;r++){const l=t[r],{min:u,max:d}=a[l],m=I(r),v=F(o+1,m),g=u+v*(d-u);x[l]=g,p[l]=S(g,"inferred",`Halton sample ${o}`)}c.push({index:o,umf:M(p),coordinates:x})}return c}function F(a,s){let t=0,c=1/s,o=a;for(;o>0;)t+=c*(o%s),o=Math.floor(o/s),c/=s;return t}function I(a){const s=[2,3,5,7,11,13,17,19,23,29,31,37,41,43,47];return s[a%s.length]}function M(a){const s=D.reduce((r,l)=>r+(O(a,l)||0),0);if(s<y)return a;const t={...a};for(const r of Object.keys(a)){if(r==="_meta")continue;const l=r,u=O(a,l);D.includes(l)&&(t[l]=S(u/s,"inferred","normalized"))}const c=O(t,"SiO2"),o=O(t,"Al2O3"),p=_.R2O.reduce((r,l)=>r+O(t,l),0),x=_.RO.reduce((r,l)=>r+O(t,l),0);return t._meta={SiO2_Al2O3_ratio:o>y?E(c/o,2):0,R2O_RO_ratio:x>y?E(p/x,2):0,totalFluxMoles:1,confidence:"inferred"},t}function ae(a){const{type:s,bounds:t,count:c,seed:o}=a,p=[],x=[],r=[];if(Object.keys(t).length===0)return r.push("Bounds are required"),{value:null,confidence:"unknown",warnings:x,errors:r,trace:p};for(const[u,d]of Object.entries(t))d.max<=d.min&&r.push(`Invalid bounds for ${u}: max (${d.max}) <= min (${d.min})`);if(r.length>0)return{value:null,confidence:"unknown",warnings:x,errors:r,trace:p};p.push({operation:"spacefill_start",inputs:{type:s,dimensions:Object.keys(t).length,count:c},output:0,note:`Generating ${c} ${s.toUpperCase()} samples in ${Object.keys(t).length}D space`});let l;switch(s){case"lhs":l=ne(t,c,o||42);break;case"sobol":l=se(t,c);break;case"halton":l=te(t,c);break;default:return r.push(`Unknown sampling type: ${s}`),{value:null,confidence:"unknown",warnings:x,errors:r,trace:p}}return p.push({operation:"spacefill_complete",inputs:{expected:c},output:l.length,note:`Generated ${l.length} samples`}),{value:l,confidence:"inferred",warnings:x,errors:r,trace:p}}const T={SiO2:{min:2,max:5},Al2O3:{min:.15,max:.6},B2O3:{min:0,max:.5},Na2O:{min:0,max:.4},K2O:{min:0,max:.4},CaO:{min:.1,max:.7},MgO:{min:0,max:.35},ZnO:{min:0,max:.3}},re={SiO2:{min:1.5,max:6},Al2O3:{min:.1,max:.8}},C={lhs:{label:"Latin Hypercube",description:"Stratified random sampling — good coverage, no clustering"},sobol:{label:"Sobol Sequence",description:"Quasi-random low-discrepancy — fills space very evenly"},halton:{label:"Halton Sequence",description:"Quasi-random with prime bases — fast, deterministic"}},L={stull:{label:"Stull Chart (SiO₂ × Al₂O₃)",bounds:re},midfire:{label:"Mid-Fire Glaze (8D)",bounds:T},custom:{label:"Custom",bounds:{}}},le=["SiO2","Al2O3","B2O3","Na2O","K2O","Li2O","CaO","MgO","ZnO","SrO","BaO"],k={SiO2:"SiO₂",Al2O3:"Al₂O₃",B2O3:"B₂O₃",Na2O:"Na₂O",K2O:"K₂O",Li2O:"Li₂O",CaO:"CaO",MgO:"MgO",ZnO:"ZnO",SrO:"SrO",BaO:"BaO"};function ie(a,s){return{id:a,name:s,source:"calculated",ingredients:[],umf:null,coneRange:[0,0],atmosphere:"unknown",surfaceType:"unknown",umfConfidence:"inferred",verified:!1}}function oe(a,s){const t=a[s];return t?t.value.toFixed(3):"—"}function ve(){Q("Space-Filling Sampler");const[a,s]=f.useState("lhs"),[t,c]=f.useState(50),[o,p]=f.useState(42),[x,r]=f.useState("midfire"),[l,u]=f.useState({...T}),[d,m]=f.useState(null),[v,g]=f.useState([]),{setBlendResults:U}=G(),P=Y(),b=f.useMemo(()=>Object.keys(l),[l]),V=f.useCallback(e=>{r(e),e!=="custom"&&u({...L[e].bounds}),m(null)},[]),R=f.useCallback((e,i,h)=>{u(j=>({...j,[e]:{...j[e],[i]:h}})),r("custom"),m(null)},[]),H=f.useCallback(e=>{u(i=>({...i,[e]:{min:0,max:.5}})),r("custom"),m(null)},[]),q=f.useCallback(e=>{u(i=>{const h={...i};return delete h[e],h}),r("custom"),m(null)},[]),$=f.useCallback(()=>{g([]);const i=ae({type:a,bounds:l,count:t,seed:a==="lhs"?o:void 0});i.value?(m(i.value),g([...i.warnings])):g([...i.errors])},[a,l,t,o]),A=b.length>=2,w=f.useMemo(()=>{if(!d||d.length===0)return b;const e=new Set(b);for(const i of d.slice(0,5))for(const h of Object.keys(i.umf)){if(h==="_meta")continue;const j=h;O(i.umf,j)>0&&e.add(j)}return Array.from(e)},[d,b]),B=f.useMemo(()=>le.filter(e=>!b.includes(e)),[b]);return n.jsxs("div",{className:"calc-page",children:[n.jsxs("div",{className:"calc-sidebar",onKeyDown:e=>{e.key==="Enter"&&!(e.target instanceof HTMLTextAreaElement)&&$()},children:[n.jsxs("div",{className:"calc-section",children:[n.jsx("h2",{children:"Space-Filling Sampler"}),n.jsx("p",{className:"subtitle",children:"Systematically explore UMF space with quasi-random sequences"})]}),n.jsxs("div",{className:"calc-section",children:[n.jsx("h3",{children:"Method"}),n.jsx("div",{style:{display:"flex",flexDirection:"column",gap:6},children:Object.entries(C).map(([e,i])=>n.jsxs("label",{style:{display:"flex",alignItems:"flex-start",gap:8,padding:"8px 10px",background:a===e?"#2a3a4a":"var(--bg-tertiary)",border:`1px solid ${a===e?"var(--accent)":"var(--border-primary)"}`,borderRadius:6,cursor:"pointer",fontSize:13},children:[n.jsx("input",{type:"radio",name:"method",checked:a===e,onChange:()=>{s(e),m(null)},style:{marginTop:2}}),n.jsxs("div",{children:[n.jsx("div",{style:{fontWeight:600},children:i.label}),n.jsx("div",{style:{color:"var(--text-secondary)",fontSize:11,marginTop:2},children:i.description})]})]},e))})]}),n.jsxs("div",{className:"calc-section",children:[n.jsx("h3",{children:"Sample Count"}),n.jsx("div",{className:"calc-controls",children:n.jsxs("div",{className:"control-row",children:[n.jsx("input",{type:"range",min:"10",max:"200",step:"10",value:t,onChange:e=>{c(Number(e.target.value)),m(null)}}),n.jsx("span",{className:"range-value",children:t})]})})]}),a==="lhs"&&n.jsxs("div",{className:"calc-section",children:[n.jsx("h3",{children:"Random Seed"}),n.jsx("input",{type:"number",value:o,onChange:e=>{p(Number(e.target.value)),m(null)},style:{background:"var(--bg-tertiary)",border:"1px solid var(--border-primary)",borderRadius:4,padding:"6px 10px",color:"var(--text-primary)",width:100,fontSize:13}}),n.jsx("span",{style:{color:"var(--text-muted)",fontSize:11,marginLeft:8},children:"Same seed → same samples"})]}),n.jsxs("div",{className:"calc-section",children:[n.jsx("h3",{children:"Bounds"}),n.jsx("select",{value:x,onChange:e=>V(e.target.value),style:{background:"var(--bg-tertiary)",border:"1px solid var(--border-primary)",borderRadius:4,padding:"6px 10px",color:"var(--text-primary)",width:"100%",fontSize:13,marginBottom:10},children:Object.entries(L).map(([e,{label:i}])=>n.jsx("option",{value:e,children:i},e))}),n.jsx("div",{style:{display:"flex",flexDirection:"column",gap:6},children:b.map(e=>n.jsxs("div",{style:{display:"grid",gridTemplateColumns:"60px 1fr 1fr 24px",gap:6,alignItems:"center",fontSize:12},children:[n.jsx("span",{style:{fontWeight:600},children:k[e]||e}),n.jsx("input",{type:"number",step:"0.05",value:l[e].min,onChange:i=>R(e,"min",Number(i.target.value)),placeholder:"min",style:z}),n.jsx("input",{type:"number",step:"0.05",value:l[e].max,onChange:i=>R(e,"max",Number(i.target.value)),placeholder:"max",style:z}),n.jsx("button",{onClick:()=>q(e),style:{background:"transparent",border:"none",color:"var(--text-muted)",cursor:"pointer",fontSize:14,padding:0},title:`Remove ${e}`,children:"×"})]},e))}),B.length>0&&n.jsxs("select",{value:"",onChange:e=>{e.target.value&&H(e.target.value)},style:{background:"var(--bg-tertiary)",border:"1px solid var(--border-primary)",borderRadius:4,padding:"4px 8px",color:"var(--text-secondary)",fontSize:12,marginTop:8},children:[n.jsx("option",{value:"",children:"+ Add oxide dimension…"}),B.map(e=>n.jsx("option",{value:e,children:k[e]||e},e))]})]}),n.jsxs("div",{className:"point-count",children:[n.jsx("strong",{children:b.length})," dimensions × ",n.jsx("strong",{children:t})," samples"]}),v.length>0&&n.jsx("div",{className:"calc-section",children:v.map((e,i)=>n.jsxs("p",{style:{color:"#e74c3c",fontSize:13,margin:"4px 0"},children:["⚠ ",e]},i))}),n.jsxs("button",{className:"calc-button",onClick:$,disabled:!A,children:["Generate ",t," Samples"]}),!A&&n.jsx("p",{style:{color:"var(--text-secondary)",fontSize:11,textAlign:"center",margin:0},children:"Need at least 2 oxide dimensions"})]}),n.jsx("div",{className:"calc-main",children:d?n.jsxs("div",{className:"results-panel",children:[n.jsxs("div",{className:"results-header",children:[n.jsxs("h3",{children:[d.length," ",C[a].label," Samples —"," ",b.length,"D"]}),n.jsxs("div",{style:{display:"flex",gap:6},children:[n.jsx("button",{onClick:()=>{const e=d.map((i,h)=>({index:h,coordinates:b.map(j=>i.coordinates[j]||0),umf:i.umf,recipe:i.recipe||ie(`sample_${h+1}`,`Sample ${h+1}`),label:`S${h+1}`}));U(e),P("/")},style:N,children:"View on Explorer"}),n.jsx("button",{onClick:()=>X(d.map((e,i)=>({label:`${a.toUpperCase()}-${i+1}`,umf:e.umf,meta:e.coordinates})),`${a}-${t}-samples.csv`),style:N,children:"CSV"}),n.jsx("button",{onClick:()=>Z(d.map((e,i)=>({label:`${a.toUpperCase()}-${i+1}`,umf:e.umf}))),style:N,children:"Print Labels"})]})]}),n.jsx("div",{className:"results-scroll",children:n.jsxs("table",{className:"results-table",children:[n.jsx("thead",{children:n.jsxs("tr",{children:[n.jsx("th",{children:"#"}),w.map(e=>n.jsx("th",{children:k[e]||e},e)),n.jsx("th",{children:"Si:Al"})]})}),n.jsx("tbody",{children:d.map((e,i)=>n.jsxs("tr",{children:[n.jsx("td",{children:i+1}),w.map(h=>n.jsx("td",{children:oe(e.umf,h)},h)),n.jsx("td",{children:K(e.umf)})]},i))})]})})]}):n.jsxs("div",{className:"empty-state",children:[n.jsx("div",{className:"icon",children:"⊞"}),n.jsx("p",{children:"Configure bounds and sampling method, then generate"}),n.jsx("p",{style:{fontSize:12,color:"var(--text-dim)"},children:C[a].description})]})}),n.jsx("style",{children:W})]})}const z={background:"var(--bg-secondary)",border:"1px solid var(--border-primary)",borderRadius:4,padding:"4px 6px",color:"var(--text-primary)",fontSize:12,width:"100%"};export{ve as SpaceFillingPage,ve as default};
